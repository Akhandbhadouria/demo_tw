{% extends 'layout.html' %}
{% load static %}
{% block content %}
<link rel="stylesheet" href="{% static 'css/edit_profile.css' %}">


<div class="profile-edit-container">
  <div class="form-card">
    <div class="form-header">
      <h2 class="form-title">Edit Your Profile</h2>
      <p class="form-subtitle">Update your information and customize your profile</p>
    </div>

    <div class="profile-layout">
      <!-- Left Side - Profile Preview -->
      <div class="profile-preview-section">
        <div class="current-profile-preview">


          <!-- Clickable Avatar -->
          <div class="clickable-avatar-wrapper" id="avatarTrigger">
            {% if request.user.userprofile.profile_photo %}
            <img src="{{ request.user.userprofile.profile_photo.url }}" alt="Profile" class="current-avatar"
              id="currentAvatar">
            {% else %}
            <img src="https://via.placeholder.com/160?text={{ request.user.username|slice:':1'|upper }}" alt="Profile"
              class="current-avatar" id="currentAvatar">
            {% endif %}
            <div class="avatar-overlay">
              <div class="avatar-overlay-content">
                <i class="fas fa-camera"></i>
                <div class="avatar-overlay-text">Change Photo</div>
              </div>
            </div>
            <div class="avatar-badge">
              <i class="fas fa-edit"></i>
            </div>
          </div>

          <div class="profile-info">
            <div class="current-username">{{ request.user.username }}</div>
            <div class="current-profession">
              {% if request.user.userprofile.profession %}
              {{ request.user.userprofile.profession }}
              {% else %}
              Add your profession
              {% endif %}
            </div>
            <div class="current-bio">
              {% if request.user.userprofile.bio %}
              {{ request.user.userprofile.bio|truncatewords:15 }}
              {% else %}
              Tell us about yourself...
              {% endif %}
              <div class="bio-fade"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Side - Form -->
      <div class="profile-form-section">
        <h3 class="section-title">
          Profile Information
        </h3>

        <form method="POST" enctype="multipart/form-data" class="profile-form" id="profileForm">
          {% csrf_token %}

          <!-- Hidden File Input -->
          <input type="file" name="profile_photo" id="profilePhotoInput" class="hidden-file-input" accept="image/*">

          <p>
            <label><i class="fas fa-user"></i> Username</label>
            {{ form.username }}
          </p>

          <p>
            <label><i class="fas fa-briefcase"></i> Profession</label>
            {{ form.profession }}
          </p>

          <p>
            <label><i class="fas fa-envelope"></i> Email</label>
            {{ form.email }}
          </p>

          <p>
            <label><i class="fas fa-align-left"></i> Bio</label>
            {{ form.bio }}
            <small class="helptext">Brief description about yourself</small>
          </p>

          <div class="button-group">
            <button type="submit" class="btn-save">
              <i class="fas fa-check-circle"></i> Save Changes
            </button>
            <a href="{% url 'profile_detail' request.user.username %}" class="btn-cancel">
              <i class="fas fa-times-circle"></i> Cancel
            </a>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const avatarTrigger = document.getElementById('avatarTrigger');
    const profilePhotoInput = document.getElementById('profilePhotoInput');
    const currentAvatar = document.getElementById('currentAvatar');
    const profileForm = document.getElementById('profileForm');

    // Click avatar to trigger file input
    avatarTrigger.addEventListener('click', function () {
      profilePhotoInput.click();
    });

    // Handle file selection
    profilePhotoInput.addEventListener('change', function (e) {
      const file = e.target.files[0];
      if (file && file.type.startsWith('image/')) {
        const reader = new FileReader();

        reader.onload = function (event) {
          // Update avatar preview with 3D effect
          currentAvatar.src = event.target.result;

          // Add temporary animation
          avatarTrigger.style.transform = 'scale(1.1) rotateY(10deg)';
          setTimeout(() => {
            avatarTrigger.style.transform = 'translateY(-5px) rotateY(5deg) rotateX(5deg)';
          }, 300);

          // Show success feedback
          const badge = avatarTrigger.querySelector('.avatar-badge i');
          badge.className = 'fas fa-check';
          setTimeout(() => {
            badge.className = 'fas fa-edit';
          }, 2000);
        };

        reader.readAsDataURL(file);
      }
    });

    // Enhanced 3D hover effects
    avatarTrigger.addEventListener('mouseenter', function () {
      this.style.transform = 'translateY(-5px) rotateY(5deg) rotateX(5deg)';
    });

    avatarTrigger.addEventListener('mouseleave', function () {
      this.style.transform = 'translateY(0) rotateY(0) rotateX(0)';
    });

    // Form submission handler
    profileForm.addEventListener('submit', function () {
      // Add submission animation
      const saveBtn = this.querySelector('.btn-save');
      saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
      saveBtn.disabled = true;
    });

    // Bio container hover effect
    const bioContainer = document.querySelector('.current-bio');
    if (bioContainer) {
      bioContainer.addEventListener('mouseenter', function () {
        this.style.transform = 'translateY(-2px) scale(1.02)';
      });

      bioContainer.addEventListener('mouseleave', function () {
        this.style.transform = 'translateY(0) scale(1)';
      });
    }

    // Add page load animation
    const formCard = document.querySelector('.form-card');
    if (formCard) {
      formCard.style.opacity = '0';
      formCard.style.transform = 'translateY(30px) rotateX(5deg)';

      setTimeout(() => {
        formCard.style.transition = 'all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
        formCard.style.opacity = '1';
        formCard.style.transform = 'translateY(0) rotateX(0)';
      }, 100);
    }

    // Input focus effects with 3D
    const inputs = profileForm.querySelectorAll('input, textarea');
    inputs.forEach(input => {
      input.addEventListener('focus', function () {
        this.parentElement.style.transform = 'translateZ(15px)';
      });

      input.addEventListener('blur', function () {
        this.parentElement.style.transform = 'translateZ(0)';
      });
    });
  });
</script>

{% endblock %}